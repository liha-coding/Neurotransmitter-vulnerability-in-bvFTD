function MENGA_run_own(folderImage,genes,out_dir,roi)

%% load files for MENGA

path_MENGA = 'C:\Users\lhahn.BNBNB22\Documents\MATLAB\Menga31\';

% ROI list
if strcmp(roi,'full')
    load([path_MENGA, 'code_MENGA_31\code\UTILITY\LISTROI\listroistruct.mat']);
elseif strcmp(roi,'short')
    load([path_MENGA, 'code_MENGA_31\code\UTILITY\LISTROI\listroifull.mat']);
end

% Mask
load([path_MENGA,'GM_mask_MNI.mat']);

% Window size
windowsize = 3;

% Gene list
genelabel = loadgenefile(genes);

pwpath = [path_MENGA, 'code_MENGA_31\']; % folder with code, data etc.

genelabel = checkgenelist(genelabel,pwpath);

% mockfolder for img2don

mockfolder = [path_MENGA,'code_MENGA_31\'];

if ~isfolder(out_dir)
   mkdir(out_dir); 
end

%% DATA LOADING AND REMAPPING in ALLEN SPACE

%importing image to donor space
img2don = MappingImage2Donors(pwpath,folderImage,listroi,windowsize,mask);

%importing genomic data
gen2don = LoadGenomicData(pwpath,genelabel,listroi);

% nr image loaded = nr of rows in expression matrix in any donor
nrimg = size(img2don(1).exp,1);
img2don_full = img2don;

for j = 1:nrimg
    
    disp(j);
    
    img2don = reduceImg2don(img2don_full,j);
    image_name = img2don(1).info.image_name{j}; % name of the image is present in any donor
    
    %% SAVE RESULTS
    % SAVE in folderImage, creating a folder
    fileResults = ['RESULTS_',char(image_name(1:end-4))]; % need to eliminate the extension
    folderResults = fullfile(out_dir,fileResults);
    mkdir(folderResults);
    
    % SAVE mat
    filename = fullfile(folderResults,[fileResults,'.mat']);
    save(filename,'gen2don','img2don','genelabel','listroi','namelistroi','mask','windowsize')
    
end

end