%% This script computes the receiver operating characteristic (ROC) curve from the output files of the JuSpace toolbox.

% indication of data path
dir_start = '/Your/Data/Path/';

% search for mat-file output for first group
files_group1 = dir([dir_start, '*indZ*.mat']);
filename_group1 = [dir_start, files_group1.name];
load(filename_FTD, 'stats');
% select Fisher's z transformed correlation coefficients
z_group1 = stats.res_ind;

clear stats

% search for mat-file output for second group
files_group2 = dir([dir_start, '*looList1*.mat']);
filename_group2 = [dir_start, files_group2.name];
load(filename_group2, 'stats');
z_group2 = stats.res_ind;

% index of receptors which were statistically significant
receptors = [2,3,6,9,11];

% compute ROC curve and save the output to file
for i = 1:size(receptors,2)
    j = receptors(i);
    % roc_curve function retrieved from https://www.mathworks.com/matlabcentral/fileexchange/52442-roc-curve
    ROC_data(i) = roc_curve(z_group1(:,j), z_group2(:,j),  1, 1);
    curve{1,i} = ROC_data(i).curve;
    AUC(1,i) = ROC_data(i).param.AROC;
end

save([dir_start,'\ROC_data.mat'],'ROC_data');

% save ROC curve X (1-Specificity) and Y (Sensitivity) values in excel sheet
j = 0;
for i = 1:size(receptors,2)
    ROC_curve(:,i+j:i+j+1) = curve{1,i};
    j = j+1;
end

xlswrite([dir_start,'ROC_data.xlsx'],ROC_curve,'curve');
xlswrite([dir_start,'ROC_data.xlsx'],AUC,'AUC');


clearvars -except ROC_curve AUC receptors dir_start

% save X (1-Specificity) and Y (Sensitivity) values for each receptor in excel sheet
ROC_curve_long_X = [];
ROC_curve_long_Y = [];
ROC_curve_long_label = [];

j = 0;
for i = 1:size(receptors,2)
    % 1-Specificity
    ROC_curve_long_X = [ROC_curve_long_X; 1-ROC_curve(:,i+j+1)];
    % Sensitivity
    ROC_curve_long_Y = [ROC_curve_long_Y; ROC_curve(:,i+j)];
    % receptor index
    ROC_curve_long_label = [ROC_curve_long_label; i*ones(75,1)];
    j = j+1;  
end

ROC_curve_long = [ROC_curve_long_X ROC_curve_long_Y ROC_curve_long_label];

AUC = AUC';

titles = ["1-Specificity","Sensitivity","Neurotransmitter"];
titles_AUC = {'AUC'};

xlswrite([dir_start,'ROC_data_long.xlsx'],titles,'curve','A1');
xlswrite([dir_start,'ROC_data_long.xlsx'],ROC_curve_long,'curve','A2');
xlswrite([dir_start,'ROC_data_long.xlsx'],titles_AUC,'AUC','A1');
xlswrite([dir_start,'ROC_data_long.xlsx'],AUC,'AUC','A2');
